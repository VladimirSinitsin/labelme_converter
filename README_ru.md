Русский | [English](README.md)

![GitHub top language](https://img.shields.io/github/languages/top/VladimirSinitsin/labelme_converter)
![GitHub](https://img.shields.io/github/license/VladimirSinitsin/labelme_converter)
![GitHub search hit counter](https://img.shields.io/github/search/VladimirSinitsin/labelme_converter/goto?color=gree)

# LABELME-CONVERTER
_**Конвертер разметки из формата LabelMe в форматы: MsCOCO, PascalVOC, Yolo. Также возможны: разбитие датасета на 
тренировочную, тестовую и валидационную выборки; аугментация конвертированного датасета; вывод и запись статистики 
по изображениям; трансформация всего датасета к единому разрешению.**_

```
Установка необходимых пакетов
>> pip install -r requirements.txt
```

Список классов в порядке их вывода в статистике прописывается в `.txt` файле (по умолчанию в `labels.txt`). Название 
файла указывается в `config.py`.

## Конвертация
### Запуск
Для конвертации используется файл `labelme_converter.py` с аргументами:
- `--input` - директория с датасетом в формате LabelMe
- `--output` - (_опционально_) директория для хранения конвертированного датасета (по умолчанию `./current_dataset`)
- `--format` - формат для конвертации (`yolo`, `voc`, `coco`)
- `--create-marked` - (_опционально_) указывается, если нужны картинки с визуализацией разметки
- `--poly` - (_опционально_) указывается, если визуализация должна быть с полигонами (не прямоугольники)


### Пример
```
Конвертация датасета из ./meters01_labelme в формат Yolo с созданием визуализации разметки
>> python labelme_converter.py --input meters01_labelme --output current_dataset --format yolo --create-marked

Input path:  labelme
Output path:  current_dataset
Reading labelme files:
100%|██████████████████████████████████████████| 24/24 [00:00<00:00, 98.69it/s]
Create marked images:
100%|██████████████████████████████████████████| 24/24 [00:00<00:00, 50.44it/s]
Converting labelme to Yolo:
100%|██████████████████████████████████████████| 24/24 [00:00<00:00, 8058.87it/s]
```

## Разбиение на train, test, val и trainval
### Запуск
Для разбиения используется файл `split_dataset.py` с аргументами:
- `--input` - директория с датасетом в одном из форматов разметки: MsCOCO, PascalVOC, Yolo
- `--output` - (_опционально_) директория для хранения разбитого датасета (по умолчанию `./splitted_dataset`)
- `--train` - процент от общего количества картинок, которые должны попасть в тренировочный набор
- `--test` - процент от общего количества картинок, которые должны попасть в тестовый набор
- `--val` - процент от общего количества картинок, которые должны попасть в валидационный набор
- `--seed` - (_опционально_) значение начального числа генератора случайных чисел (по умолчанию: `42`)

### Пример
```
Разбиение датасета из ./current_dataset в соотношении 80/15/5 с seed равным 101
>> python split_dataset.py --input current_dataset --train 80 --test 15 --val 5 --seed 101

Dataset on current_dataset is being split!
Output split dataset path: splitted_dataset
Dataset is splitted!
```

## Аугментация датасета
### Запуск
Для аугментации используется файл `augment_dataset.py` с аргументами:
- `--input` - директория с датасетом в одном из форматов разметки: MsCOCO, PascalVOC, Yolo (может быть разбитым)
- `--output` - (_опционально_) директория для хранения разбитого датасета (по умолчанию `./augmented_dataset`)
- `--full` - (_опционально_) если аугментируете все наборы в разбитом датасете, то просто указать этот аргумент
- `--train` - (_опционально_) аугментация тренировочного набора в разбитом датасете
- `--test` - (_опционально_) аугментация тестового набора в разбитом датасете
- `--val` - (_опционально_) аугментация валидационного набора в разбитом датасете
- `--count` - количество аугментированных копий одного изображения

### Примеры
```
Аугментация всего неразбитого набора, хранящегося в ./current_dataset с 3-мя копиями каждого изображения
>> python augment_dataset.py --input current_dataset --count 3 

Augmentation train_test_val set:
100%|██████████████████████████████████████████| 24/24 [00:06<00:00,  3.52it/s]
(meters)
```
```
Аугментация тренировочного и тестового наборов из разбитого датасета (набор trainval меняется)
>> python augment_dataset.py --input splitted_dataset --train --test --count 5

Augmentation train set:
100%|██████████████████████████████████████████| 19/19 [00:07<00:00,  2.50it/s]
Augmentation test set:
100%|██████████████████████████████████████████| 3/3 [00:01<00:00,  2.62it/s]
```

## Создание статистики по датасетам
### Запуск
Для вывода и записи статистики используется файл `statistics_dataset.py` с аргументами:
- `--input` - директория с датасетом в одном из форматов разметки: MsCOCO, PascalVOC, Yolo (может быть разбитым или аугментированным)
- `--save` - (_опционально_) ставится, если надо сохранить статистику в файл (`stat.txt`)
- `--save_path` - (_опционально_) если надо сохранить файл в конкретную директорию (по умолчанию сохраняется в директорию датасета)

### Примеры
```
Вывод статистики по конвертированному датасету с сохранением статистики в файл
>> python statistics_dataset.py --input current_dataset --save

+------------------------------------------------------------------+
|               train_test_val | count of images: 24               |
+---------+-------------------+-----------+------------+-----------+
|  class  | number of objects | avg_width | avg_height |  avg_area |
+---------+-------------------+-----------+------------+-----------+
|  meter  |         24        |   410.25  |   417.42   | 182052.79 |
|  value  |         24        |   191.29  |   51.21    |  11516.71 |
|  seal2  |         29        |   82.45   |   72.07    |  7140.14  |
|  model  |         17        |   119.24  |   26.94    |  3488.65  |
|  serial |         23        |   115.52  |   18.70    |  2652.00  |
|   seal  |         23        |   164.30  |   154.57   |  24377.17 |
|   mag   |         18        |   34.50   |   38.56    |  1516.61  |
| breaker |         16        |   155.88  |   196.06   |  31059.19 |
+---------+-------------------+-----------+------------+-----------+
```
```
Вывод статистики по разбитому датасету без сохранения файла
>> python statistics_dataset.py --input splitted_dataset

+------------------------------------------------------------------+
|                   train | count of images: 19                    |
+---------+-------------------+-----------+------------+-----------+
|  class  | number of objects | avg_width | avg_height |  avg_area |
+---------+-------------------+-----------+------------+-----------+
|  meter  |         19        |   395.58  |   411.05   | 171485.26 |
|  value  |         19        |   183.05  |   51.11    |  10799.26 |
|   seal  |         16        |   155.19  |   151.06   |  21259.50 |
|   mag   |         13        |   30.62   |   33.54    |  1071.46  |
|  seal2  |         24        |   78.75   |   70.04    |  6600.00  |
|  model  |         14        |   107.64  |   25.93    |  2955.64  |
|  serial |         18        |   110.44  |   17.33    |  2226.56  |
| breaker |         12        |   160.50  |   184.33   |  31833.42 |
+---------+-------------------+-----------+------------+-----------+

+------------------------------------------------------------------+
|                    test | count of images: 3                     |
+---------+-------------------+-----------+------------+-----------+
|  class  | number of objects | avg_width | avg_height |  avg_area |
+---------+-------------------+-----------+------------+-----------+
|  meter  |         3         |   420.33  |   366.33   | 163746.67 |
|  value  |         3         |   217.33  |   47.00    |  13863.67 |
|   seal  |         5         |   146.20  |   151.40   |  22713.60 |
|   mag   |         3         |   38.33   |   50.67    |  2490.00  |
|  model  |         2         |   158.00  |   26.00    |  4578.00  |
|  serial |         3         |   123.33  |   19.33    |  3868.33  |
| breaker |         4         |   142.00  |   231.25   |  28736.50 |
|  seal2  |         3         |   65.33   |   52.67    |  3784.67  |
+---------+-------------------+-----------+------------+-----------+

+-----------------------------------------------------------------+
|                     val | count of images: 2                    |
+--------+-------------------+-----------+------------+-----------+
| class  | number of objects | avg_width | avg_height |  avg_area |
+--------+-------------------+-----------+------------+-----------+
| meter  |         2         |   534.50  |   554.50   | 309903.50 |
| value  |         2         |   230.50  |   58.50    |  14812.00 |
|  seal  |         2         |   282.50  |   190.50   |  53477.50 |
|  mag   |         2         |   54.00   |   53.00    |  2950.00  |
| seal2  |         2         |   152.50  |   125.50   |  18655.00 |
| serial |         2         |   149.50  |   30.00    |  4656.50  |
| model  |         1         |   204.00  |   43.00    |  8772.00  |
+--------+-------------------+-----------+------------+-----------+

+------------------------------------------------------------------+
|                  trainval | count of images: 21                  |
+---------+-------------------+-----------+------------+-----------+
|  class  | number of objects | avg_width | avg_height |  avg_area |
+---------+-------------------+-----------+------------+-----------+
|  meter  |         21        |   408.81  |   424.71   | 184667.95 |
|  value  |         21        |   187.57  |   51.81    |  11181.43 |
|   seal  |         18        |   169.33  |   155.44   |  24839.28 |
|   mag   |         15        |   33.73   |   36.13    |  1321.93  |
|  seal2  |         26        |   84.42   |   74.31    |  7527.31  |
|  model  |         15        |   114.07  |   27.07    |  3343.40  |
|  serial |         20        |   114.35  |   18.60    |  2469.55  |
| breaker |         12        |   160.50  |   184.33   |  31833.42 |
+---------+-------------------+-----------+------------+-----------+
```
```
Вывод статистики по аугментированному неразбитому датасету с количеством копий равному 5, также статистика сохраняется по пути ./stat/stat.txt
>> python statistics_dataset.py --input augmented_dataset --save --save_path stat

+------------------------------------------------------------------+
|              train_test_val | count of images: 120               |
+---------+-------------------+-----------+------------+-----------+
|  class  | number of objects | avg_width | avg_height |  avg_area |
+---------+-------------------+-----------+------------+-----------+
|  meter  |        120        |   426.29  |   441.95   | 201052.84 |
|  value  |        120        |   197.42  |   60.44    |  14066.77 |
|  seal2  |        145        |   85.43   |   74.40    |  7367.63  |
|  model  |         85        |   123.21  |   32.36    |  4433.02  |
|  serial |        115        |   118.58  |   23.93    |  3487.95  |
|   seal  |        115        |   172.86  |   164.56   |  27600.59 |
|   mag   |         90        |   35.52   |   41.13    |  1628.20  |
| breaker |         80        |   163.86  |   193.43   |  32002.40 |
+---------+-------------------+-----------+------------+-----------+
```

## Трансформация всех изображений датасета к одному разрешению (с трансформацией координат разметки соответственно).
### Запуск
Для трансформации используется файл `resize_dataset.py` с аргументами:
- `--input` - директория с датасетом в одном из форматов разметки: MsCOCO, PascalVOC, Yolo (может быть разбитым или аугментированным)
- `--output` - (_опционально_) директория для сохранения нового датасета (по умолчанию: `./resized_dataset`)
- `--new_w` - ширина изображений в пикселях
- `--new_h` - высота изображений в пикселях

### Пример
```
Ресайз разбитого датасета до 512х512 (в формате MsCOCO для разбитого выводится три процессбара, в остальных - один)
Сохраняется в директорию по умолчанию: ./resized_dataset
>> python resize_dataset.py --input splitted_dataset --new_w 512 --new_h 512                        

Resize images in Train set:
100%|██████████████████████████████████████████| 19/19 [00:00<00:00, 27.08it/s]
Resize images in Test set:
100%|██████████████████████████████████████████| 3/3 [00:00<00:00, 25.54it/s]
Resize images in Val set:
100%|██████████████████████████████████████████| 2/2 [00:00<00:00, 28.34it/s]
Resize images in TrainVal set:
100%|██████████████████████████████████████████| 21/21 [00:00<00:00, 33.62it/s] 
```
